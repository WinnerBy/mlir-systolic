# MLIR-Systolic å·¥ä½œè¿›å±•åˆ†æä¸ä¸‹ä¸€æ­¥è®¡åˆ’

> **æ›´æ–°æ—¥æœŸ**: 2025-12-15  
> **çŠ¶æ€**: åŸºç¡€è®¾æ–½å·²å°±ç»ªï¼Œæ ¸å¿ƒåŠŸèƒ½å¾…å®ç°

---

## ğŸ“Š å½“å‰å·¥ä½œè¿›å±•æ€»ç»“

### âœ… Phase 1: åŸºç¡€è®¾æ–½ï¼ˆå·²å®Œæˆï¼‰

#### 1.1 é¡¹ç›®ç»“æ„ âœ…
- [x] CMake æ„å»ºç³»ç»Ÿé…ç½®å®Œæˆ
- [x] ç›®å½•ç»“æ„å»ºç«‹ï¼ˆinclude/lib/tools/test/docsï¼‰
- [x] Dialect å®šä¹‰ç›®å½•ç»“æ„
- [x] Pass å’Œ Translation æ¡†æ¶

#### 1.2 Dialect å®šä¹‰ âœ…
- [x] **HLS Dialect** (`include/systolic/Dialect/HLS/`)
  - `HLS.td` - Dialect å®šä¹‰
  - `Ops.td` - æ“ä½œå®šä¹‰
  - `Types.td` - ç±»å‹å®šä¹‰
  - `HLSDialect.cpp` - å®ç°ï¼ˆ~300è¡Œï¼‰

- [x] **SystolicDataflow Dialect** (`include/systolic/Dialect/SystolicDataflow/`) â­
  - `SystolicDataflow.td` - Dialect å®šä¹‰
  - `SystolicDataflowOps.td` - æ“ä½œå®šä¹‰ï¼ˆIOModuleOp, PEArrayOp, DoubleBufferOp, DrainModuleOpï¼‰
  - `SystolicDataflowDialect.cpp` - å®ç°æ¡†æ¶

#### 1.3 å·¥å…·é“¾ âœ…
- [x] `systolic-opt` - Pass åº”ç”¨å·¥å…·
- [x] `systolic-translate` - ä»£ç ç”Ÿæˆå·¥å…·
- [x] Pass æ³¨å†Œæœºåˆ¶

#### 1.4 æµ‹è¯•åŸºç¡€è®¾æ–½ âœ…
- [x] æµ‹è¯•ç”¨ä¾‹ç›®å½•ç»“æ„
- [x] AutoSA å‚è€ƒæ ·æœ¬ï¼ˆ`test/reference-samples/`ï¼‰
- [x] æµ‹è¯•è„šæœ¬æ¡†æ¶

---

### âš ï¸ Phase 2: æ ¸å¿ƒå®ç°ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

#### 2.1 SystolicTransform Pass âš ï¸ **æ¡†æ¶å®Œæˆï¼ŒPolymeré›†æˆå¾…å®Œå–„**

**æ–‡ä»¶**: `lib/Transforms/SystolicTransform.cpp` (~776è¡Œ)

**å·²å®Œæˆ**:
- [x] Pass æ¡†æ¶å’Œé€‰é¡¹è§£æ
- [x] å¾ªç¯åˆæ³•æ€§æ£€æŸ¥ï¼ˆ`checkLegality`ï¼‰
- [x] ç©ºé—´å¾ªç¯é€‰æ‹©é€»è¾‘ï¼ˆ`selectSpaceLoops`ï¼‰
- [x] å¾ªç¯ç½®æ¢é€»è¾‘ï¼ˆ`permuteLoopsForSpaceTime`ï¼‰
- [x] å¤šçº§åˆ†å—æ¡†æ¶ï¼ˆ`applyMultiLevelTiling`ï¼‰
- [x] é—®é¢˜è§„æ¨¡æ¨æ–­æ¡†æ¶

**å¾…å®Œå–„**:
- [ ] **Polymer é›†æˆ**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼š
  - [ ] SCoP æå–å®Œæ•´å®ç°
  - [ ] è°ƒåº¦æ ‘è®¡ç®—
  - [ ] ä¾èµ–è·ç¦»åˆ†æï¼ˆä½¿ç”¨ ISLï¼‰
- [ ] é—®é¢˜è§„æ¨¡æ¨æ–­çš„å®Œæ•´å®ç°ï¼ˆä» memref shapesï¼‰
- [ ] SIMD å‘é‡åŒ–æ”¯æŒ

**å…³é”®ä»£ç ä½ç½®**:
```cpp
// lib/Transforms/SystolicTransform.cpp:604
// Method 2: Extract from memref shapes (TODO: implement)

// lib/Analysis/PolymerAnalysis.cpp:74
// TODO: Complete the SCoP extraction by:
// 1. Walking affine.for loops
// 2. Adding domain relations for each statement
// 3. Adding access relations (read/write)
// 4. Building the schedule
```

#### 2.2 SystolicDataflowGeneration Pass âš ï¸ **æ¡†æ¶å®Œæˆï¼Œå®ç°å¾…å®Œå–„**

**æ–‡ä»¶**: `lib/Transforms/SystolicDataflowGeneration.cpp` (~397è¡Œ)

**å·²å®Œæˆ**:
- [x] Pass æ¡†æ¶
- [x] `ArrayRefGroup` æ•°æ®ç»“æ„å®šä¹‰
- [x] æ•°ç»„å¼•ç”¨åˆ†ææ¡†æ¶ï¼ˆ`analyzeArrayReferences`ï¼‰
- [x] IO å±‚çº§åˆ†ææ¡†æ¶

**å¾…å®Œå–„**:
- [ ] æ•°ç»„å¼•ç”¨åˆ†ç»„çš„å®Œæ•´å®ç°ï¼ˆIO/PE/Drain åˆ†ç±»ï¼‰
- [ ] IO å±‚çº§ç¡®å®šçš„å®Œæ•´é€»è¾‘ï¼ˆL1/L2/L3ï¼‰
- [ ] SystolicDataflow Dialect æ“ä½œç”Ÿæˆ
- [ ] åŒç¼“å†²é€»è¾‘ç”Ÿæˆ
- [ ] åŸºäºè°ƒåº¦æ ‘çš„æ¨¡å—è¾¹ç•Œç¡®å®š â­

**å…³é”®ä»£ç ä½ç½®**:
```cpp
// lib/Transforms/SystolicDataflowGeneration.cpp:184
// TODO: More sophisticated analysis using Polymer/ISL
```

#### 2.3 SystolicDataflowToHLS Pass âš ï¸ **æ¡†æ¶å®Œæˆï¼Œé™çº§é€»è¾‘å¾…å®ç°**

**æ–‡ä»¶**: `lib/Transforms/SystolicDataflowToHLS.cpp` (~232è¡Œ)

**å·²å®Œæˆ**:
- [x] Pass æ¡†æ¶
- [x] Conversion Pattern æ¡†æ¶ï¼ˆIOModuleOpLowering, PEArrayOpLowering, DrainModuleOpLoweringï¼‰
- [x] åŒç¼“å†²é™çº§æ¡†æ¶

**å¾…å®Œå–„**:
- [ ] HLS Dialect æ“ä½œåˆ›å»ºï¼ˆéœ€è¦ HLS Dialect å®Œæ•´å®šä¹‰ï¼‰
- [ ] åŒç¼“å†²é€»è¾‘è½¬æ¢ä¸º Affine loops + SCF if
- [ ] Stream æ“ä½œæ˜ å°„åˆ° HLS Stream
- [ ] å®Œæ•´çš„ Dialect è½¬æ¢æµç¨‹

**å…³é”®ä»£ç ä½ç½®**:
```cpp
// lib/Transforms/SystolicDataflowToHLS.cpp:68
// TODO: Implement actual HLS task creation based on HLS Dialect API

// lib/Transforms/SystolicDataflowToHLS.cpp:157
// TODO: Implement actual double buffering logic
```

#### 2.4 EmitHLSCpp Translation âš ï¸ **æ¡†æ¶å®Œæˆï¼Œä»£ç ç”Ÿæˆå¾…å®ç°**

**æ–‡ä»¶**: `lib/Translation/EmitHLSCpp.cpp` (~746è¡Œ)

**å·²å®Œæˆ**:
- [x] ç¿»è¯‘æ¡†æ¶
- [x] `HLSCppEmitter` ç±»ç»“æ„
- [x] ç±»å‹æ˜ å°„æ¡†æ¶ï¼ˆ`getTypeName`, `getStreamTypeName`ï¼‰
- [x] æ“ä½œå‘å°„æ¡†æ¶ï¼ˆ`emitOperation`, `emitFunc`, `emitAffineFor`ï¼‰

**å¾…å®Œå–„**:
- [ ] å®Œæ•´çš„ HLS C++ ä»£ç ç”Ÿæˆ
- [ ] Pragma æ’å…¥é€»è¾‘ï¼ˆpipeline, array_partition ç­‰ï¼‰
- [ ] Stream ç±»å‹ç”Ÿæˆ
- [ ] å¤šå‡½æ•°æ¨¡å¼æ”¯æŒï¼ˆæ¯ä¸ªæ¨¡å—ä¸€ä¸ªå‡½æ•°ï¼‰
- [ ] ä¸ AutoSA è¾“å‡ºæ ¼å¼å¯¹é½

---

### âš ï¸ Phase 3: Polymer é›†æˆï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰â­

**æ–‡ä»¶**: `lib/Analysis/PolymerAnalysis.cpp` (~261è¡Œ)

**çŠ¶æ€**: **æ¡†æ¶å·²å°±ç»ªï¼Œæ ¸å¿ƒå®ç°å¾…å®Œæˆ**

#### å·²å®Œæˆ âœ…
- [x] Polymer å¯ç”¨æ€§æ£€æµ‹
- [x] `PolymerScop` ç±»æ¡†æ¶
- [x] `ScheduleTreeInfo` ç»“æ„å®šä¹‰
- [x] æ¥å£å‡½æ•°æ¡†æ¶
- [x] CMake é“¾æ¥é…ç½®

#### å¾…å®ç° âš ï¸ï¼ˆå…³é”®é˜»å¡ç‚¹ï¼‰

**1. SCoP æå–** (`PolymerScop::extract`)
```cpp
// å½“å‰çŠ¶æ€: åªåˆ›å»ºäº† IslScop å¯¹è±¡ï¼Œæœªå¡«å……å†…å®¹
// éœ€è¦å®ç°:
// 1. éå† affine.for å¾ªç¯
// 2. ä¸ºæ¯ä¸ªè¯­å¥æ·»åŠ  domain relation
// 3. æ·»åŠ  access relations (read/write)
// 4. æ„å»ºè°ƒåº¦æ ‘
```

**2. è°ƒåº¦æ ‘è®¡ç®—** (`PolymerScop::computeSchedule`)
```cpp
// å½“å‰çŠ¶æ€: åªèƒ½è·å–å·²æœ‰è°ƒåº¦æ ‘ï¼Œæ— æ³•è®¡ç®—æ–°è°ƒåº¦æ ‘
// éœ€è¦å®ç°:
// 1. è·å– domain å’Œ dependences
// 2. è°ƒç”¨ isl_schedule_compute() æˆ– polymer::computeSchedule()
// 3. è¿”å›è®¡ç®—çš„è°ƒåº¦æ ‘
```

**3. ä¾èµ–è®¡ç®—** (`PolymerScop::computeDependences`)
```cpp
// å½“å‰çŠ¶æ€: è¿”å› nullptr
// éœ€è¦å®ç°:
// 1. è°ƒç”¨ polymer::computeDependences() æˆ– isl_union_map_compute_flow()
// 2. è¿”å›ä¾èµ–æ˜ å°„
```

**4. ä¾èµ–è·ç¦»è®¡ç®—** (`PolymerScop::computeDependenceDistances`)
```cpp
// å½“å‰çŠ¶æ€: è¿”å› nullptr
// éœ€è¦å®ç°:
// 1. ä»ä¾èµ–æ˜ å°„ä¸­æå–è·ç¦»å‘é‡
// 2. è®¡ç®—æ¯ä¸ªå¾ªç¯ç»´åº¦çš„ min/max è·ç¦»
// 3. è¿”å›è·ç¦»æ˜ å°„
```

**5. è°ƒåº¦æ ‘åˆ†æ** (`analyzeScheduleTree`)
```cpp
// å½“å‰çŠ¶æ€: åªä¿å­˜è°ƒåº¦æ ‘ï¼Œæœªåˆ†æ
// éœ€è¦å®ç°:
// 1. éå†è°ƒåº¦æ ‘èŠ‚ç‚¹
// 2. ä»è°ƒåº¦èŠ‚ç‚¹æå–ä¾èµ–è·ç¦»
// 3. è¯†åˆ«ç©ºé—´å¾ªç¯å€™é€‰ï¼ˆè·ç¦» <= 1ï¼‰
```

**6. ä¾èµ–è·ç¦»æå–** (`computeDependenceDistancesWithPolymer`)
```cpp
// å½“å‰çŠ¶æ€: æ¡†æ¶å®Œæ•´ï¼Œä½†æœ€åä¸€æ­¥æœªå®ç°
// éœ€è¦å®ç°:
// 1. è§£æè·ç¦»æ˜ å°„ï¼Œæå–æ¯ä¸ªå¾ªç¯ç»´åº¦çš„è·ç¦»
// 2. å¡«å…… LoopDependenceDistance ç»“æ„
```

**å‚è€ƒèµ„æº**:
- Polymer æºä»£ç : `Polygeist/tools/polymer/`
- AutoSA å®ç°: `autosa_utils.cpp::get_dep_dis_at_node`
- ISL æ–‡æ¡£: ISL Schedule Tree API

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

### ğŸ”´ **P0: Polymer é›†æˆå®Œæˆ**ï¼ˆé˜»å¡æ‰€æœ‰åç»­å·¥ä½œï¼‰

**ç›®æ ‡**: å®Œæˆ Polymer é›†æˆï¼Œä½¿ä¾èµ–åˆ†æå’Œè°ƒåº¦æ ‘åˆ†æå¯ç”¨

**ä»»åŠ¡æ¸…å•**:

1. **SCoP æå–å®ç°** (3-5å¤©)
   - ç ”ç©¶ Polymer çš„ `extractScopStmt()` å®ç°
   - å®ç°å¾ªç¯éå†å’Œè¯­å¥æå–
   - å®ç° domain å’Œ access relation æ„å»º
   - æµ‹è¯•ï¼šéªŒè¯ SCoP æå–æ­£ç¡®æ€§

2. **è°ƒåº¦æ ‘è®¡ç®—å®ç°** (2-3å¤©)
   - ç ”ç©¶ ISL `isl_schedule_compute()` API
   - å®ç°è°ƒåº¦æ ‘è®¡ç®—é€»è¾‘
   - æµ‹è¯•ï¼šéªŒè¯è°ƒåº¦æ ‘ç»“æ„æ­£ç¡®æ€§

3. **ä¾èµ–è®¡ç®—å®ç°** (2-3å¤©)
   - ç ”ç©¶ Polymer/ISL ä¾èµ–è®¡ç®— API
   - å®ç°ä¾èµ–æ˜ å°„è®¡ç®—
   - æµ‹è¯•ï¼šéªŒè¯ä¾èµ–å…³ç³»æ­£ç¡®æ€§

4. **ä¾èµ–è·ç¦»è®¡ç®—å®ç°** (3-4å¤©)
   - ç ”ç©¶ AutoSA çš„ `get_dep_dis_at_node` å®ç°
   - å®ç°è·ç¦»å‘é‡æå–
   - å®ç° min/max è·ç¦»è®¡ç®—
   - æµ‹è¯•ï¼šéªŒè¯è·ç¦»è®¡ç®—æ­£ç¡®æ€§

5. **è°ƒåº¦æ ‘åˆ†æå®ç°** (2-3å¤©)
   - ç ”ç©¶ ISL Schedule Tree éå† API
   - å®ç°èŠ‚ç‚¹éå†å’Œè·ç¦»æå–
   - å®ç°ç©ºé—´å¾ªç¯å€™é€‰è¯†åˆ«
   - æµ‹è¯•ï¼šéªŒè¯åˆ†æç»“æœæ­£ç¡®æ€§

6. **ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•** (2-3å¤©)
   - åœ¨ `SystolicTransform` Pass ä¸­é›†æˆ Polymer åˆ†æ
   - éªŒè¯ä¾èµ–è·ç¦»åˆ†æç»“æœ
   - éªŒè¯ç©ºé—´å¾ªç¯é€‰æ‹©ç»“æœ
   - å¯¹æ¯” AutoSA çš„åˆ†æç»“æœ

**é¢„è®¡æ—¶é—´**: 14-21 å¤©

**æˆåŠŸæ ‡å‡†**:
- [ ] èƒ½å¤Ÿä» MLIR Affine IR æå– SCoP
- [ ] èƒ½å¤Ÿè®¡ç®—è°ƒåº¦æ ‘
- [ ] èƒ½å¤Ÿè®¡ç®—ä¾èµ–è·ç¦»
- [ ] èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«ç©ºé—´å¾ªç¯ï¼ˆä¾èµ–è·ç¦» â‰¤ 1ï¼‰
- [ ] ä¸ AutoSA çš„åˆ†æç»“æœä¸€è‡´

---

### ğŸŸ¡ **P1: SystolicDataflowGeneration å®Œæ•´å®ç°**

**ç›®æ ‡**: å®Œæˆæ•°æ®æµæŠ½è±¡ç”Ÿæˆï¼Œå°† Affine IR è½¬æ¢ä¸º SystolicDataflow Dialect

**å‰ç½®æ¡ä»¶**: P0 å®Œæˆï¼ˆéœ€è¦è°ƒåº¦æ ‘æ¥ç¡®å®šæ¨¡å—è¾¹ç•Œï¼‰

**ä»»åŠ¡æ¸…å•**:

1. **æ•°ç»„å¼•ç”¨åˆ†ç»„å®Œæ•´å®ç°** (3-4å¤©)
   - å®ç° IO_GROUP/PE_GROUP/DRAIN_GROUP åˆ†ç±»é€»è¾‘
   - å®ç°è®¿é—®æ¨¡å¼åˆ†æï¼ˆè¯»/å†™/ç´¯åŠ ï¼‰
   - æµ‹è¯•ï¼šéªŒè¯åˆ†ç»„æ­£ç¡®æ€§

2. **IO å±‚çº§ç¡®å®š** (2-3å¤©)
   - å®ç° L1/L2/L3 å±‚çº§åˆ¤æ–­é€»è¾‘
   - åŸºäºå¾ªç¯åµŒå¥—æ·±åº¦å’Œè®¿é—®æ¨¡å¼
   - æµ‹è¯•ï¼šéªŒè¯å±‚çº§åˆ¤æ–­æ­£ç¡®æ€§

3. **åŸºäºè°ƒåº¦æ ‘çš„æ¨¡å—è¾¹ç•Œç¡®å®š** â­ (3-4å¤©)
   - ä½¿ç”¨ Polymer è°ƒåº¦æ ‘ç¡®å®šæ¨¡å—è¾¹ç•Œ
   - ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºç‹¬ç«‹çš„ SystolicDataflow æ“ä½œ
   - æµ‹è¯•ï¼šéªŒè¯æ¨¡å—åˆ†è§£æ­£ç¡®æ€§

4. **SystolicDataflow æ“ä½œç”Ÿæˆ** (4-5å¤©)
   - ç”Ÿæˆ `IOModuleOp` (L1/L2/L3)
   - ç”Ÿæˆ `PEArrayOp`
   - ç”Ÿæˆ `DrainModuleOp`
   - ç”Ÿæˆ `DoubleBufferOp`
   - æµ‹è¯•ï¼šéªŒè¯ç”Ÿæˆçš„ IR ç»“æ„æ­£ç¡®æ€§

5. **åŒç¼“å†²é€»è¾‘ç”Ÿæˆ** (3-4å¤©)
   - å®ç° ping-pong ç¼“å†²åŒºåˆ†é…
   - å®ç° inter-transfer å’Œ intra-transfer é€»è¾‘
   - æµ‹è¯•ï¼šéªŒè¯åŒç¼“å†²é€»è¾‘æ­£ç¡®æ€§

**é¢„è®¡æ—¶é—´**: 15-20 å¤©

**æˆåŠŸæ ‡å‡†**:
- [ ] èƒ½å¤Ÿå°† Affine IR è½¬æ¢ä¸º SystolicDataflow Dialect
- [ ] ç”Ÿæˆçš„ IR åŒ…å«æ­£ç¡®çš„ IO/PE/Drain æ¨¡å—
- [ ] åŒç¼“å†²é€»è¾‘æ­£ç¡®ç”Ÿæˆ
- [ ] æ¯ä¸ªæ¨¡å—å¯¹åº”è°ƒåº¦æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹

---

### ğŸŸ¡ **P2: SystolicDataflowToHLS å®Œæ•´å®ç°**

**ç›®æ ‡**: å®Œæˆ Dialect é™çº§ï¼Œå°† SystolicDataflow è½¬æ¢ä¸º HLS Dialect

**å‰ç½®æ¡ä»¶**: P1 å®Œæˆï¼ŒHLS Dialect å®šä¹‰å®Œæ•´

**ä»»åŠ¡æ¸…å•**:

1. **HLS Dialect å®Œå–„** (2-3å¤©)
   - å®Œå–„ HLS Dialect æ“ä½œå®šä¹‰ï¼ˆdataflow.task, stream ç­‰ï¼‰
   - ç¡®ä¿ HLS Dialect æ”¯æŒæ‰€éœ€åŠŸèƒ½
   - æµ‹è¯•ï¼šéªŒè¯ Dialect å®šä¹‰å®Œæ•´æ€§

2. **IO æ¨¡å—é™çº§** (3-4å¤©)
   - å®ç° `IOModuleOp` â†’ `hls.dataflow.task` è½¬æ¢
   - å®ç° Stream ç±»å‹è½¬æ¢
   - æµ‹è¯•ï¼šéªŒè¯é™çº§æ­£ç¡®æ€§

3. **PE é˜µåˆ—é™çº§** (3-4å¤©)
   - å®ç° `PEArrayOp` â†’ `hls.dataflow.task` è½¬æ¢
   - å®ç° PE å®ä¾‹åŒ–é€»è¾‘
   - æµ‹è¯•ï¼šéªŒè¯é™çº§æ­£ç¡®æ€§

4. **åŒç¼“å†²é™çº§** (4-5å¤©)
   - å®ç° `DoubleBufferOp` â†’ Affine loops + SCF if
   - å®ç° ping-pong åˆ‡æ¢é€»è¾‘
   - å®ç° inter/intra-transfer é€»è¾‘
   - æµ‹è¯•ï¼šéªŒè¯é™çº§æ­£ç¡®æ€§

5. **Drain æ¨¡å—é™çº§** (2-3å¤©)
   - å®ç° `DrainModuleOp` â†’ `hls.dataflow.task` è½¬æ¢
   - æµ‹è¯•ï¼šéªŒè¯é™çº§æ­£ç¡®æ€§

**é¢„è®¡æ—¶é—´**: 14-19 å¤©

**æˆåŠŸæ ‡å‡†**:
- [ ] èƒ½å¤Ÿå°† SystolicDataflow Dialect é™çº§åˆ° HLS Dialect
- [ ] åŒç¼“å†²é€»è¾‘æ­£ç¡®è½¬æ¢ä¸ºå¾ªç¯ç»“æ„
- [ ] æ¯ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ task

---

### ğŸŸ¡ **P3: EmitHLSCpp å®Œæ•´å®ç°**

**ç›®æ ‡**: å®Œæˆ HLS C++ ä»£ç ç”Ÿæˆï¼Œè¾“å‡ºå¯ç»¼åˆçš„ HLS ä»£ç 

**å‰ç½®æ¡ä»¶**: P2 å®Œæˆ

**ä»»åŠ¡æ¸…å•**:

1. **ç±»å‹æ˜ å°„å®Œå–„** (2-3å¤©)
   - å®Œå–„ MLIR ç±»å‹åˆ° HLS C++ ç±»å‹æ˜ å°„
   - å®ç° Stream ç±»å‹ç”Ÿæˆ
   - å®ç° SIMD ç±»å‹ç”Ÿæˆ
   - æµ‹è¯•ï¼šéªŒè¯ç±»å‹æ˜ å°„æ­£ç¡®æ€§

2. **æ“ä½œå‘å°„å®ç°** (5-7å¤©)
   - å®ç° `emitAffineFor` å®Œæ•´é€»è¾‘
   - å®ç° `emitAffineIf` å®Œæ•´é€»è¾‘
   - å®ç° `emitAffineLoad/Store` å®Œæ•´é€»è¾‘
   - å®ç° `emitArith` æ“ä½œå‘å°„
   - æµ‹è¯•ï¼šéªŒè¯æ“ä½œå‘å°„æ­£ç¡®æ€§

3. **Pragma æ’å…¥** (3-4å¤©)
   - å®ç° pipeline pragma æ’å…¥
   - å®ç° array_partition pragma æ’å…¥
   - å®ç° dataflow pragma æ’å…¥
   - å®ç° interface pragma æ’å…¥
   - æµ‹è¯•ï¼šéªŒè¯ pragma æ’å…¥æ­£ç¡®æ€§

4. **å¤šå‡½æ•°æ¨¡å¼æ”¯æŒ** (3-4å¤©)
   - å®ç°æ¯ä¸ªæ¨¡å—ç”Ÿæˆç‹¬ç«‹å‡½æ•°
   - å®ç°å‡½æ•°å£°æ˜ç”Ÿæˆ
   - å®ç°é¡¶å±‚ kernel å‡½æ•°ç”Ÿæˆ
   - æµ‹è¯•ï¼šéªŒè¯å‡½æ•°ç»“æ„æ­£ç¡®æ€§

5. **ä»£ç æ ¼å¼åŒ–å’Œä¼˜åŒ–** (2-3å¤©)
   - å®ç°ä»£ç æ ¼å¼åŒ–
   - å®ç°æ³¨é‡Šç”Ÿæˆ
   - ä¸ AutoSA è¾“å‡ºæ ¼å¼å¯¹é½
   - æµ‹è¯•ï¼šéªŒè¯è¾“å‡ºæ ¼å¼æ­£ç¡®æ€§

**é¢„è®¡æ—¶é—´**: 15-21 å¤©

**æˆåŠŸæ ‡å‡†**:
- [ ] èƒ½å¤Ÿç”Ÿæˆå¯ç»¼åˆçš„ HLS C++ ä»£ç 
- [ ] ç”Ÿæˆçš„ä»£ç å¯ä»¥é€šè¿‡ Vitis HLS ç¼–è¯‘
- [ ] ä»£ç ç»“æ„ä¸ AutoSA è¾“å‡ºç›¸ä¼¼
- [ ] æ¯ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªç‹¬ç«‹å‡½æ•°

---

### ğŸŸ¢ **P4: ç«¯åˆ°ç«¯æµ‹è¯•å’ŒéªŒè¯**

**ç›®æ ‡**: å®Œæˆç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒéªŒè¯æ•´ä¸ªæµç¨‹çš„æ­£ç¡®æ€§

**å‰ç½®æ¡ä»¶**: P0, P1, P2, P3 å®Œæˆ

**ä»»åŠ¡æ¸…å•**:

1. **MatMul ç«¯åˆ°ç«¯æµ‹è¯•** (3-4å¤©)
   - åˆ›å»ºå®Œæ•´çš„ MatMul æµ‹è¯•ç”¨ä¾‹
   - è¿è¡Œå®Œæ•´ç¼–è¯‘æµç¨‹
   - å¯¹æ¯” AutoSA è¾“å‡º
   - éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§

2. **å¤šå‚æ•°ç»„åˆæµ‹è¯•** (2-3å¤©)
   - æµ‹è¯•ä¸åŒçš„ array_part å’Œ latency ç»„åˆ
   - æµ‹è¯•ä¸åŒçš„ space_time æ¨¡å¼
   - æµ‹è¯• SIMD å‘é‡åŒ–
   - éªŒè¯å‚æ•°å½±å“æ­£ç¡®æ€§

3. **æ€§èƒ½å¯¹æ¯”** (2-3å¤©)
   - å¯¹æ¯”ç”Ÿæˆçš„ HLS ä»£ç ä¸ AutoSA è¾“å‡º
   - éªŒè¯ç¡¬ä»¶èµ„æºä½¿ç”¨
   - éªŒè¯æ€§èƒ½ç‰¹å¾

4. **è¾¹ç•Œæƒ…å†µæµ‹è¯•** (2-3å¤©)
   - æµ‹è¯•ä¸åŒé—®é¢˜è§„æ¨¡
   - æµ‹è¯•è¾¹ç•Œæ¡ä»¶
   - éªŒè¯é”™è¯¯å¤„ç†

**é¢„è®¡æ—¶é—´**: 9-13 å¤©

**æˆåŠŸæ ‡å‡†**:
- [ ] MatMul ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- [ ] ç”Ÿæˆçš„ä»£ç ä¸ AutoSA è¾“å‡ºåŠŸèƒ½ç­‰ä»·
- [ ] å¤šå‚æ•°ç»„åˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç è´¨é‡è¾¾åˆ°ç”Ÿäº§çº§åˆ«

---

## ğŸ“ˆ æ€»ä½“æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | ä¾èµ–å…³ç³» |
|------|--------|---------|---------|
| P0: Polymer é›†æˆ | ğŸ”´ P0 | 14-21 å¤© | æ—  |
| P1: SystolicDataflowGeneration | ğŸŸ¡ P1 | 15-20 å¤© | P0 |
| P2: SystolicDataflowToHLS | ğŸŸ¡ P2 | 14-19 å¤© | P1 |
| P3: EmitHLSCpp | ğŸŸ¡ P3 | 15-21 å¤© | P2 |
| P4: ç«¯åˆ°ç«¯æµ‹è¯• | ğŸŸ¢ P4 | 9-13 å¤© | P0-P3 |

**æ€»è®¡**: 67-94 å¤©ï¼ˆçº¦ 3-4 ä¸ªæœˆï¼Œå‡è®¾å…¨èŒå¼€å‘ï¼‰

---

## ğŸ” å…³é”®é£é™©ç‚¹

### 1. Polymer é›†æˆå¤æ‚åº¦ âš ï¸ **é«˜é£é™©**
- **é£é™©**: Polymer API æ–‡æ¡£ä¸å®Œæ•´ï¼Œéœ€è¦æ·±å…¥é˜…è¯»æºä»£ç 
- **ç¼“è§£**: 
  - å‚è€ƒ AutoSA çš„å®ç°
  - å‚è€ƒ Polymer çš„æµ‹è¯•ç”¨ä¾‹
  - é€æ­¥å®ç°ï¼Œæ¯ä¸ªåŠŸèƒ½å•ç‹¬æµ‹è¯•

### 2. è°ƒåº¦æ ‘ä¸æ¨¡å—åˆ†è§£ âš ï¸ **é«˜é£é™©**
- **é£é™©**: å¦‚ä½•åŸºäºè°ƒåº¦æ ‘ç¡®å®šæ¨¡å—è¾¹ç•Œæ˜¯æ ¸å¿ƒéš¾ç‚¹
- **ç¼“è§£**:
  - æ·±å…¥ç ”ç©¶ AutoSA çš„å®ç°
  - å‚è€ƒ AutoSA çš„è°ƒåº¦æ ‘æ ‡è®°æœºåˆ¶
  - å…ˆå®ç°ç®€åŒ–ç‰ˆæœ¬ï¼Œå†é€æ­¥å®Œå–„

### 3. HLS Dialect å®šä¹‰å®Œæ•´æ€§ âš ï¸ **ä¸­é£é™©**
- **é£é™©**: HLS Dialect å¯èƒ½ç¼ºå°‘å¿…è¦çš„æ“ä½œ
- **ç¼“è§£**:
  - æå‰å®¡æŸ¥ HLS Dialect å®šä¹‰
  - å‚è€ƒ ScaleHLS çš„ HLS Dialect
  - å¿…è¦æ—¶æ‰©å±• HLS Dialect

### 4. ä»£ç ç”Ÿæˆè´¨é‡ âš ï¸ **ä¸­é£é™©**
- **é£é™©**: ç”Ÿæˆçš„ HLS ä»£ç å¯èƒ½æ— æ³•é€šè¿‡ Vitis HLS ç¼–è¯‘
- **ç¼“è§£**:
  - ä¸ AutoSA è¾“å‡ºé€è¡Œå¯¹æ¯”
  - é€æ­¥æµ‹è¯•æ¯ä¸ªæ¨¡å—çš„ä»£ç ç”Ÿæˆ
  - å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

---

## ğŸ’¡ å»ºè®®çš„å¼€å‘ç­–ç•¥

### 1. è¿­ä»£å¼€å‘
- æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•
- ä¸è¦ç­‰åˆ°æ‰€æœ‰åŠŸèƒ½å®Œæˆå†æµ‹è¯•
- åŠæ—¶å‘ç°é—®é¢˜å¹¶ä¿®å¤

### 2. å‚è€ƒ AutoSA
- AutoSA æ˜¯åŠŸèƒ½å®Œæ•´çš„å‚è€ƒå®ç°
- é‡åˆ°é—®é¢˜æ—¶å…ˆæŸ¥çœ‹ AutoSA çš„å®ç°
- ä¿æŒä¸ AutoSA çš„å…¼å®¹æ€§

### 3. æµ‹è¯•é©±åŠ¨
- ä¸ºæ¯ä¸ªåŠŸèƒ½ç¼–å†™æµ‹è¯•ç”¨ä¾‹
- ä½¿ç”¨ AutoSA çš„è¾“å‡ºä½œä¸ºå‚è€ƒ
- å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

### 4. æ–‡æ¡£åŒæ­¥
- åŠæ—¶æ›´æ–°æŠ€æœ¯æ–‡æ¡£
- è®°å½•å®ç°ç»†èŠ‚å’Œè®¾è®¡å†³ç­–
- ä¿æŒæ–‡æ¡£ä¸ä»£ç åŒæ­¥

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆæœ¬å‘¨ï¼‰

1. **æ·±å…¥ç ”ç©¶ Polymer API**
   - é˜…è¯» Polymer æºä»£ç 
   - ç ”ç©¶ `extractScopStmt()` å®ç°
   - ç ”ç©¶ ISL Schedule Tree API

2. **å®ç° SCoP æå–**
   - ä»ç®€å•çš„å•å±‚å¾ªç¯å¼€å§‹
   - é€æ­¥æ‰©å±•åˆ°å¤šå±‚å¾ªç¯
   - éªŒè¯æå–ç»“æœ

3. **å»ºç«‹æµ‹è¯•æ¡†æ¶**
   - åˆ›å»º Polymer é›†æˆçš„å•å…ƒæµ‹è¯•
   - åˆ›å»ºç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶
   - å»ºç«‹ä¸ AutoSA çš„å¯¹æ¯”æœºåˆ¶

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰

- å®Œæˆ Polymer SCoP æå–
- å®Œæˆè°ƒåº¦æ ‘è®¡ç®—
- å®Œæˆä¾èµ–è·ç¦»åˆ†æ
- éªŒè¯åˆ†æç»“æœä¸ AutoSA ä¸€è‡´

### ä¸­æœŸç›®æ ‡ï¼ˆ1-2æœˆï¼‰

- å®Œæˆ Polymer é›†æˆï¼ˆP0ï¼‰
- å®Œæˆ SystolicDataflowGenerationï¼ˆP1ï¼‰
- å®Œæˆ SystolicDataflowToHLSï¼ˆP2ï¼‰

### é•¿æœŸç›®æ ‡ï¼ˆ3-4æœˆï¼‰

- å®Œæˆ EmitHLSCppï¼ˆP3ï¼‰
- å®Œæˆç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆP4ï¼‰
- è¾¾åˆ°ç”Ÿäº§çº§åˆ«ä»£ç è´¨é‡

---

## ğŸ“š å‚è€ƒèµ„æº

### ä»£ç åº“
- **AutoSA**: `UCLA-VAST/AutoSA` - å‚è€ƒå®ç°
- **Polymer**: `llvm/Polygeist/tools/polymer` - å¤šé¢ä½“åˆ†æ
- **ScaleHLS**: `UIUC-ChenLab/scalehls` - HLS Dialect å‚è€ƒ

### æ–‡æ¡£
- `docs/AUTOSA_ANALYSIS.md` - AutoSA è¯¦ç»†åˆ†æ
- `docs/POLYMER_INTEGRATION.md` - Polymer é›†æˆæ–¹æ¡ˆ
- `docs/TECHNICAL_REDESIGN.md` - æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### å…³é”®æ–‡ä»¶
- `lib/Analysis/PolymerAnalysis.cpp` - Polymer é›†æˆå®ç°
- `lib/Transforms/SystolicTransform.cpp` - å˜æ¢ Pass
- `lib/Transforms/SystolicDataflowGeneration.cpp` - æ•°æ®æµç”Ÿæˆ
- `lib/Translation/EmitHLSCpp.cpp` - ä»£ç ç”Ÿæˆ

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éšç€å®ç°è¿›å±•æŒç»­æ›´æ–°ï¼Œç¡®ä¿è®¡åˆ’ä¸å®é™…è¿›å±•åŒæ­¥ã€‚

